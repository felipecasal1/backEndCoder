<h1>Tu carrito</h1>

{{#if cart.products.length}}
<ul id="productsList">
  {{#each cart.products}}
  <li>
    <strong>{{product.title}}</strong> - ${{product.price}}
    <form>
      style="display:inline;">
      <button type="submit">Eliminar</button>
    </form>
  </li>
  {{/each}}
</ul>
<hr />

<!-- Formulario para vaciar carrito -->
<form action="/api/carts/{{cart._id}}?_method=DELETE" method="POST">
  <button type="submit">Vaciar carrito</button>
</form>
<a href="/api/products">Seguir comprando</a>
{{else}}
<p>Tu carrito está vacío.</p>
<a href="/">Ir a productos</a>
{{/if}}

<script src="/socket.io/socket.io.js"></script>
<script>

  const socket = io();
  socket.on("cartUpdated", (updatedCart) => {
    console.log("Carrito actualizado recibido:", updatedCart);
    console.log(updatedCart._id)
    // Reconstruye el HTML de la lista de productos.
    let html = "";
    if (updatedCart.products && updatedCart.products.length > 0) 
      updatedCart.products.forEach(p => {
        html += `<li>
                  <strong>${p.product.title}</strong> - $${p.product.price}
                  <form action="/api/carts/6844bd6806d9247ca9fd9c07/products/${p.product._id}?_method=DELETE" method="POST" style="display:inline;">
                  <button type="submit">Eliminar</button>
                  </form>
                </li>`;
      });
    } else {
      html = "<p>Tu carrito está vacío.</p>";
    }
    // Actualiza el contenido del <ul> con id "productsList".
    document.getElementById("productsList").innerHTML = html;
  });
</script>